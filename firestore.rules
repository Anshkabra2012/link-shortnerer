service cloud.firestore {
  match /databases/{database}/documents {
    
    // Allow anyone to read links for redirection
    match /links/{linkId} {
      allow read: if true; 
      allow write: if request.auth == null; // Anyone can shorten a link
    }
    
    // IP spam prevention logic
    match /ips/{ipId} {
      allow read, write: if request.auth == null && request.resource.data.keys().hasOnly(["lastRequest"]);
    }
  }
}
